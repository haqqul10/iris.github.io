<!doctype html>
<html lang="en" style="overflow-x: hidden;">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- favicon -->
  <link rel="shortcut icon" href="images/icons/FavIcon.svg">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="libraries/bootstrap/css/bootstrap.min.css">

  <!-- icons botstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />

  <!-- MyCSS -->
  <link rel="stylesheet" href="styles/main.css">

  <link rel="stylesheet" href="libraries/jquery/toastr.min.css">

  <title>Sign Up</title>

  <style>
    .grecaptcha-badge{
      z-index: 999;
    }
  </style>
</head>

<body class="body-login">

  <!-- halaman Sign Up -->
  <main class="login-container">
    <div class="container">
      <div class="row justify-content-center login-container__inner">
        <div class="col-11">
          <div class="row justify-content-center">

            <div class="col-2 col-md-10 col-lg-6 left left__sign-up d-none d-lg-flex">
              <img src="./images/login/signup-illustration-inner.png"
                class="img-fluid my-auto mx-auto login-container__left-image login-container__left-image--task"
                width="1855" height="1420">
            </div>

            <div class="col-12 col-md-10 col-lg-6 right">
              <img src="./images/icons/Logo-login.svg" alt="" width="82" height="40">
              <h4 class="text-white">Create Your Iris Account</h4>
              <form class="text-white" id="my-form">

                <div class="login-container__form-item">
                  <label for="email" class="form-label">Email address</label>
                  <div class="login-container__form-field">
                    <input type="email" class="form-control" id="email" placeholder="Email Address">
                    <span class="login-container__form-field-gradient"></span>
                  </div>
                </div>
                <div class="login-container__form-item">
                  <label for="license" class="form-label">License Key</label>
                  <div class="login-container__form-field">
                    <input type="text" class="form-control" id="license" placeholder="License  Key">
                    <span class="login-container__form-field-gradient"></span>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12 col-md-6">
                    <label for="username" class="form-label">Username</label>
                    <div class="login-container__form-field">
                      <input type="text" class="form-control" id="username" placeholder="Username">
                      <span class="login-container__form-field-gradient"></span>
                    </div>
                  </div>
                  <div class="col-12 col-md-6 form-password-responsive">
                    <label for="password" class="form-label">Password</label>
                    <div class="form-password login-container__form-field">
                      <input type="password" class="form-control" id="password" placeholder="Password">
                      <span class="login-container__form-field-gradient"></span>
                      <i class="bi bi-eye-slash me-3 login-container__form-field-pwicon" id="togglePassword"></i>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-lg-12 form-check">
                  <input type="checkbox" class="form-check-input" id="exampleCheck1">
                  <label class="form-check-label" for="exampleCheck1">By signing up I agree to Sastly <a href="#">Terms
                      &amp; Conditons</a> and <a href="#">Privacy Policy</a></label>
                </div>

                <div class="col-12 col-lg-12">
                  <button type="submit" name="register-submit" id="register-submit" value="Sign Up" 
                  class="btn btn-primary mb-4 g-recaptcha">Sign Up</button>
                </div>

                <p class="login-container__form-link">Already an user? <a href="login.html" class="forget-password">
                    Login</a></p>
                <hr class="login-container__form-separator">
                <p class="text-center privacy">
                  <a href="#">Terms &amp; Conditions</a>
                  <a href="#">Privacy Policy</a>
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
      <img src="./images/homepage/Ellipse.png" alt="shadow" class="login-illustration">
    </div>
  </main>
  <!-- akhir halaman Sign Up -->

  <!-- Optional JavaScript; choose one of the two! -->

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="libraries/bootstrap/js/bootstrap.js"></script>
  <script src="libraries/jquery/jquery-3.5.1.js"></script>
  <script src="libraries/jquery/toastr.min.js"></script>

  <script>
    toastr.options = {
      "positionClass": "toast-bottom-right",
    }
  </script>

  <script>
    const togglePassword = document.querySelector('#togglePassword');
    const password = document.querySelector('#password');
    togglePassword.addEventListener('click', function (e) {
      // toggle the type attribute
      const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
      password.setAttribute('type', type);
      // toggle the eye / eye slash icon
      this.classList.toggle('bi-eye');
    });
  </script>
  <!-- Option 2: Separate Popper and Bootstrap JS -->
  <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></scrip>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></s>
    -->

  <script src="https://www.google.com/recaptcha/api.js?render=6LcOurccAAAAAERdc7FHm4WyG7H3BG3JLq7wzme7"></script>
  <script>
    var submit_myform = function(event) {
      event.preventDefault();
      var token_recaptcha = "";

      grecaptcha.ready(function() {
      // do request for recaptcha token
      // response is promise with passed token
          grecaptcha.execute('6LcOurccAAAAAERdc7FHm4WyG7H3BG3JLq7wzme7', {action:'validate_captcha'})
                    .then(function(token) {
              // add token value to form
              token_recaptcha = token;
              storeRegister();
              // document.getElementById('g-recaptcha-response').value = token;
          });
      });

      async function storeRegister(){
        if($('#exampleCheck1:checked').length === 1){
          console.log(token_recaptcha);
          var request = $.ajax({
            url: "/api/register",
            method: "POST",
            data: {
              email: $("#email").val(),
              username: $("#username").val(),
              license: $("#license").val(),
              password: $("#password").val(),
              captcha: token_recaptcha
            },
            timeout: 5000,
          })
          .done(function (data, textStatus, xhr) {
            console.log("good: " + textStatus);
            window.location.replace("/dashboard");
          })
          .fail(function (data, textStatus, xhr) {
            console.log("bad: " + textStatus);
            $("#email").effect(
              "shake", {
                direction: "left",
                times: 3,
                distance: 5
              },
              500
            );
            $("#license").effect(
              "shake", {
                direction: "left",
                times: 3,
                distance: 5
              },
              500
            );
            $("#username").effect(
              "shake", {
                direction: "left",
                times: 3,
                distance: 5
              },
              500
            );
            $("#password").effect(
              "shake", {
                direction: "left",
                times: 3,
                distance: 5
              },
              500
            );
          });
        }else{
          toastr.error('Please Confirm The Terms & Conditions Checkbox.', 'Error')
        }
      }
    };

    // your form
    var form = document.getElementById("my-form");

    // attach event listener
    form.addEventListener("submit", submit_myform, true);
  </script>
</body>

</html>